# =============================================================================
# Synthea-FR Dashboard FHIR - Docker Compose
# =============================================================================
# Usage:
#   docker-compose build        # Construire l'image
#   docker-compose up -d        # Lancer en arrière-plan
#   docker-compose logs -f      # Voir les logs
#   docker-compose down         # Arrêter
# =============================================================================

services:
  synthea-fhir:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: synthea-fhir-dashboard
    restart: unless-stopped
    ports:
      - "8501:8501"
    volumes:
      # Persistance des données FHIR générées
      - fhir_data:/app/output/fhir
      # Persistance des datasets générés
      - datasets_data:/app/datasets
    environment:
      # Configuration Streamlit
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_HEADLESS=true
      - STREAMLIT_BROWSER_GATHER_USAGE_STATS=false
      # API Keys (optionnel - pour Dataset Builder)
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    labels:
      - "com.synthea.description=Dashboard FHIR Synthea-FR"
      - "com.synthea.version=1.0"

volumes:
  fhir_data:
    name: synthea-fhir-data
  datasets_data:
    name: synthea-datasets

# =============================================================================
# Configuration optionnelle avec Nginx reverse proxy
# Décommenter pour activer HTTPS
# =============================================================================
# services:
#   nginx:
#     image: nginx:alpine
#     container_name: synthea-nginx
#     restart: unless-stopped
#     ports:
#       - "80:80"
#       - "443:443"
#     volumes:
#       - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
#       - ./nginx/ssl:/etc/nginx/ssl:ro
#     depends_on:
#       - synthea-fhir
